{% extends 'base.html' %}
{% load url from future %}
{% load comments %}
{% block title %}
Gleaning Details
{% endblock title %}
{% block body %}
<style>
.glean-title{text-align: center;color:#444;}
.glean-title:hover{color:#000;text-decoration: none;}
.glean-details{border: 1px solid #e5e5e5; padding:2%;}
.glean-half{width:48%;float:left;text-align:center;}
.glean-half>ul {list-style:none;margin:0 0 0 0;}
.glean-quarter{width:48%;margin:0 1%; float:left;}
.divider{width:100%; clear:both; border-bottom:dotted #444 1px;margin:10px 0;}
.glean-address{text-align: center;margin-bottom:0px;}
.glean-date{text-align: center;margin-top:0px;}
#id_comment{height:20px;width:50%;margin-left:2%;}
.comments{border: 1px solid #e5e5e5; margin:2%;padding:2%;}
.admin-controls{text-align:center;}

</style>

<div class="span5 glean-details">
	<a class="glean-title" href="{% url 'gleanevent:detailglean' glean.id %}"><h2>{{glean.title}} {% if glean.farm %}at {{glean.farm}}{% endif %}</h2></a>
  <h4 class='glean-address'> by {{glean.member_organization}}</h4>
  <h4 class='glean-address'>{{glean.address_one}} {{glean.city}}, {{glean.state}}</h4>
  <h3 class="glean-date">{{glean.date}} {% if glean.time %}- {{glean.time}}{% endif %}</h3>
  <div class="glean-half">
  {% if not glean.happened %}
  <h5>Will you attend?</h5>
  <a href="{% url 'gleanevent:confirmlink' glean.id %}" class="btn btn-success">Yes!</a>
  <a href="{% url 'gleanevent:denylink' glean.id %}" class="btn btn-danger">No :(</a>
  {% else %}
  Gleaned!
  {% endif %}
  </div>
  <div class="glean-half">
    <h5>Volunteers</h5>
      <ul>
        <li>Required:{{glean.volunteers_needed}}</li>
        <li>Yays:{{glean.rsvped.count}}</li>
        <li>Nays:{{glean.not_rsvped.count}}</li>
      </ul>
    
  </div>
  
  <div class="divider">&nbsp;</div>
  <div class="admin-controls">
  {% if perms.gleanevent.auth and user.profile_set.get.member_organization == glean.member_organization or perms.gleanevent.uniauth %}
  {% if not glean.happened %}
<p>
  <a href="{% url 'announce:announceglean' glean.id %}" class="btn btn-primary">Create Announcement</a> <a href="{% url 'gleanevent:editglean' glean.id %}"class="btn btn-warning">Edit Glean</a>
</p>
<p>
  <a href="{% url 'gleanevent:postglean' glean.id %}" class="btn btn-danger">
    Enter Data
  </a>
</p>
  {% endif %}
  {% endif %}
  </div>
  
  {% if glean.description %}
	<p>{{glean.description|linebreaks}}</p>
  {% endif %}
  <div class="glean-half">
	<h4>Directions</h4>
  <p>{{glean.render_directions|linebreaks}}</p>
  </div>
  <div class="glean-half">
  <h4>Instructions</h4>
  <p>{{glean.render_instructions|linebreaks}}</p>
  </div>
</div>
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map-canvas { height: 100% }
</style>
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBHs-DW2GgXZL0nvZ4xj8q5AhdJQ9sNpaY&sensor=false">
</script>
<script type="text/javascript">

var geocoder;
var map;
function initialize() {
  geocoder = new google.maps.Geocoder();
  var latlng = new google.maps.LatLng(44.554283, -72.601981);
  var mapOptions = {
    zoom: 9,
    center: latlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
}

function codeAddress() {
  var address = '{{glean.address_one}} {{glean.address_two}} {{glean.city}}, {{glean.state}}';
  geocoder.geocode( { 'address': address}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}

google.maps.event.addDomListener(window, 'load', initialize);
google.maps.event.addDomListener(window, 'load', codeAddress);

</script>
<div class="span6" id="map-canvas" style="height:400px;"></div>
<div class="span6">
  <div class="comments">
  {% render_comment_list for glean %}
  </div>
  {% get_comment_form for glean as form %}
  {% if user.is_authenticated %}
    <form action="{% comment_form_target %}" method="POST">
    {% csrf_token %}
    {{ form.comment }}
    {{ form.honeypot }}
    {{ form.content_type }}
    {{ form.object_pk }}
    {{ form.timestamp }}
    {{ form.security_hash }}
    <input type="hidden" name="next" value="{% url 'gleanevent:detailglean' glean.id %}" />
    <input type="submit" value="Post a Comment" id="id_submit" />
    </form>
{% else %}
    <p>Please <a href="{% url 'auth_login' %}">log in</a> to leave a comment.</p>
{% endif %}
</div>

{% endblock body %}